#==============================================================================================
# Global Configuration
#==============================================================================================
- name:                             Define global settings
  hosts:                            localhost
  connection:                       local
  gather_facts:                     no

#==============================================================================================
# Set local and global variables
#==============================================================================================
  vars_files:
    - ../../../global-vars/apic-details.yaml

  tasks:
    - name:
      set_fact:
        desired_state:
          status:                   'modified,created'
          #status:                  deleted

#==============================================================================================
# APIC access information
#==============================================================================================
    - name:                         apic details
      set_fact:
        apic_info:                  &apic_info
          host:                     "{{ apic_info.host }}"
          username:                 "{{ apic_info.username }}"
          password:                 "{{ apic_info.password }}"
          validate_certs:           no

        rest_info:                  &rest_info
          use_proxy:                no
          path:                     /api/mo/.json
          method:                   post
  tags:                             always

#==============================================================================================
# Export Contract to Common
#==============================================================================================
- name:                             Export Contract to Common
  hosts:                            localhost
  connection:                       local
  gather_facts:                     no

  vars_files:
    - ./vars/contract-vars.yaml

  tasks:
    - name:                         Export Contract
      aci_rest:
          <<:                       *apic_info
          <<:                       *rest_info
          content:
            vzCPIf:
              attributes:
                dn:                 uni/tn-common/cif-dave
                name:               "{{ item.cont_name }}"
                status:             'created,modified'
      with_items:
        "{{ L3outContract }}"
  tags:                             exportContract
